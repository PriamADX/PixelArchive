<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>PixelArchive</title>

  <style>
    body {
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #00ffcc;
    }

    #search {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 20px;
      border-radius: 8px;
      border: none;
    }

    .file {
      background: #222;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 10px;
    }

    .file h3 {
      margin: 0;
      color: #00ffcc;
    }

    .file a {
      display: inline-block;
      margin-top: 6px;
      background: #00ffcc;
      color: black;
      padding: 6px 10px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
    }

    #message {
      color: #aaa;
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>

<body>

<h1>üì¶ PixelArchive</h1>

<input id="search" placeholder="üîç rechercher un fichier">

<div id="files"></div>
<div id="message"></div>

<script>
const SHEET_URL =
"https://docs.google.com/spreadsheets/d/1LyUjqpyXucK97PMsuQH5wjU7PQj-LWZYunfuN1Pl5NM/export?format=csv";

let fichiers = [];

fetch(SHEET_URL)
  .then(res => res.text())
  .then(text => {
    const lignes = text.split("\n").slice(1);

    lignes.forEach(ligne => {
      // cherche un lien drive
      const lienMatch = ligne.match(/https:\/\/drive\.google\.com[^\s"]+/);
      if (!lienMatch) return;

      const lien = lienMatch[0];

      // r√©cup√®re l‚ÄôID
      const idMatch =
        lien.match(/id=([^&]+)/) || lien.match(/\/d\/([^/]+)/);
      if (!idMatch) return;

      const id = idMatch[1];
      const download =
        "https://drive.google.com/uc?export=download&id=" + id;

      // titre (2e colonne du form)
      const titre = ligne.split(",")[1] || "Sans titre";

      fichiers.push({ titre, download });
    });

    afficher(fichiers);
  });

function afficher(liste) {
  const zone = document.getElementById("files");
  const msg = document.getElementById("message");

  zone.innerHTML = "";
  msg.innerHTML = "";

  if (liste.length === 0) {
    msg.innerHTML = "üò¢ Aucun fichier trouv√©";
    return;
  }

  liste.forEach(f => {
    zone.innerHTML += `
      <div class="file">
        <h3>${f.titre}</h3>
        <a href="${f.download}" target="_blank">‚¨áÔ∏è T√©l√©charger</a>
      </div>
    `;
  });
}

// üîç recherche (NE DISPARA√éT JAMAIS)
document.getElementById("search").addEventListener("input", e => {
  const q = e.target.value.toLowerCase();
  const filtre = fichiers.filter(f =>
    f.titre.toLowerCase().includes(q)
  );
  afficher(filtre);
});
</script>

</body>
</html>
